<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>NtDll.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">oshi-core-shaded</a> &gt; <a href="../index.html" class="el_bundle">oshi-core</a> &gt; <a href="index.source.html" class="el_package">oshi.jna.platform.windows</a> &gt; <span class="el_source">NtDll.java</span></div><h1>NtDll.java</h1><pre class="source lang-java linenums">/*
 * MIT License
 *
 * Copyright (c) 2022-2022 The OSHI Project Contributors: https://github.com/oshi/oshi/graphs/contributors
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the &quot;Software&quot;), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 */
package oshi.jna.platform.windows;

import com.sun.jna.Native;
import com.sun.jna.Pointer;
import com.sun.jna.Structure;
import com.sun.jna.Structure.FieldOrder;
import com.sun.jna.platform.win32.BaseTSD.ULONG_PTR;
import com.sun.jna.platform.win32.WinNT.HANDLE;
import com.sun.jna.ptr.IntByReference;
import com.sun.jna.win32.W32APIOptions;

public interface NtDll extends com.sun.jna.platform.win32.NtDll {

<span class="nc" id="L37">    NtDll INSTANCE = Native.load(&quot;NtDll&quot;, NtDll.class, W32APIOptions.DEFAULT_OPTIONS);</span>

    int PROCESS_BASIC_INFORMATION = 0;

    @FieldOrder({ &quot;Reserved1&quot;, &quot;PebBaseAddress&quot;, &quot;Reserved2&quot; })
<span class="nc" id="L42">    class PROCESS_BASIC_INFORMATION extends Structure {</span>
        public Pointer Reserved1;
        public Pointer PebBaseAddress;
<span class="nc" id="L45">        public Pointer[] Reserved2 = new Pointer[4];</span>
    }

    @FieldOrder({ &quot;pad&quot;, &quot;pad2&quot;, &quot;ProcessParameters&quot; })
<span class="nc" id="L49">    class PEB extends Structure {</span>
<span class="nc" id="L50">        public byte[] pad = new byte[4];</span>
<span class="nc" id="L51">        public Pointer[] pad2 = new Pointer[3];</span>
        public Pointer ProcessParameters; // RTL_USER_PROCESS_PARAMETERS
    }

    @FieldOrder({ &quot;MaximumLength&quot;, &quot;Length&quot;, &quot;Flags&quot;, &quot;DebugFlags&quot;, &quot;ConsoleHandle&quot;, &quot;ConsoleFlags&quot;, &quot;StandardInput&quot;,
            &quot;StandardOutput&quot;, &quot;StandardError&quot;, &quot;CurrentDirectory&quot;, &quot;DllPath&quot;, &quot;ImagePathName&quot;, &quot;CommandLine&quot;,
            &quot;Environment&quot;, &quot;StartingX&quot;, &quot;StartingY&quot;, &quot;CountX&quot;, &quot;CountY&quot;, &quot;CountCharsX&quot;, &quot;CountCharsY&quot;, &quot;FillAttribute&quot;,
            &quot;WindowFlags&quot;, &quot;ShowWindowFlags&quot;, &quot;WindowTitle&quot;, &quot;DesktopInfo&quot;, &quot;ShellInfo&quot;, &quot;RuntimeData&quot;,
            &quot;CurrentDirectories&quot;, &quot;EnvironmentSize&quot;, &quot;EnvironmentVersion&quot;, &quot;PackageDependencyData&quot;, &quot;ProcessGroupId&quot;,
            &quot;LoaderThreads&quot;, &quot;RedirectionDllName&quot;, &quot;HeapPartitionName&quot;, &quot;DefaultThreadpoolCpuSetMasks&quot;,
            &quot;DefaultThreadpoolCpuSetMaskCount&quot; })
<span class="nc" id="L62">    class RTL_USER_PROCESS_PARAMETERS extends Structure {</span>
        public int MaximumLength;
        public int Length;
        public int Flags;
        public int DebugFlags;
        public HANDLE ConsoleHandle;
        public int ConsoleFlags;
        public HANDLE StandardInput;
        public HANDLE StandardOutput;
        public HANDLE StandardError;
        public CURDIR CurrentDirectory;
        public UNICODE_STRING DllPath;
        public UNICODE_STRING ImagePathName;
        public UNICODE_STRING CommandLine;
        public Pointer Environment;
        public int StartingX;
        public int StartingY;
        public int CountX;
        public int CountY;
        public int CountCharsX;
        public int CountCharsY;
        public int FillAttribute;
        public int WindowFlags;
        public int ShowWindowFlags;
        public UNICODE_STRING WindowTitle;
        public UNICODE_STRING DesktopInfo;
        public UNICODE_STRING ShellInfo;
        public UNICODE_STRING RuntimeData;
<span class="nc" id="L90">        public RTL_DRIVE_LETTER_CURDIR[] CurrentDirectories = new RTL_DRIVE_LETTER_CURDIR[32];</span>
        public ULONG_PTR EnvironmentSize;
        public ULONG_PTR EnvironmentVersion;
        public Pointer PackageDependencyData;
        public int ProcessGroupId;
        public int LoaderThreads;
        public UNICODE_STRING RedirectionDllName;
        public UNICODE_STRING HeapPartitionName;
        public ULONG_PTR DefaultThreadpoolCpuSetMasks;
        public int DefaultThreadpoolCpuSetMaskCount;
    }

    @FieldOrder({ &quot;Length&quot;, &quot;MaximumLength&quot;, &quot;Buffer&quot; })
<span class="nc" id="L103">    class UNICODE_STRING extends Structure {</span>
        public short Length;
        public short MaximumLength;
        public Pointer Buffer;
    }

    @FieldOrder({ &quot;Length&quot;, &quot;MaximumLength&quot;, &quot;Buffer&quot; })
<span class="nc" id="L110">    class STRING extends Structure {</span>
        public short Length;
        public short MaximumLength;
        public Pointer Buffer;
    }

    @FieldOrder({ &quot;DosPath&quot;, &quot;Handle&quot; })
<span class="nc" id="L117">    class CURDIR extends Structure {</span>
        public UNICODE_STRING DosPath;
        public Pointer Handle;
    }

    @FieldOrder({ &quot;Flags&quot;, &quot;Length&quot;, &quot;TimeStamp&quot;, &quot;DosPath&quot; })
<span class="nc" id="L123">    class RTL_DRIVE_LETTER_CURDIR extends Structure {</span>
        public short Flags;
        public short Length;
        public int TimeStamp;
        public STRING DosPath;
    }

    /*
     * Windows API docs say NtQueryInformationProcess may be altered or unavailable
     * in future versions of Windows. Applications should use the alternate
     * functions listed in this topic. However, there is no other way to get this
     * information, it's been officially non-API for over a decade, and many many
     * programs including windows sysinternal tools rely on this behavior, so the
     * odds of it going away are small.
     */
    int NtQueryInformationProcess(HANDLE ProcessHandle, int ProcessInformationClass, Pointer ProcessInformation,
            int ProcessInformationLength, IntByReference ReturnLength);
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>